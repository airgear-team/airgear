<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd">

    <!-- Create Goods Table -->
    <changeSet id="addGoodsTable" author="ilya.deus">
        <createTable tableName="goods">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(1000)">
                <constraints nullable="false"/>
            </column>
            <column name="price" type="DECIMAL(19, 2)">
                <constraints nullable="false"/>
            </column>
            <column name="location" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="addWeekendsPrice" author="Oleksandr Panchenko">
        <addColumn tableName="goods">
            <column name="weekends_price" type="DECIMAL(19, 2)">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- Create Role Table -->
    <changeSet id="addRoleTable" author="ilya.deus">
        <createTable tableName="role">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Create User Table -->
    <changeSet id="addUserTable" author="ilya.deus">
        <createTable tableName="user">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="username" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="phone" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Create User_Roles Join Table -->
    <changeSet id="addUserRolesJoinTable" author="ilya.deus">
        <createTable tableName="user_roles">
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="role_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Add Foreign Key Constraint for Goods Table -->
    <changeSet id="addForeignKeyConstraintGoodsTable" author="ilya.deus">
        <addForeignKeyConstraint
                baseTableName="goods"
                baseColumnNames="user_id"
                constraintName="fk_goods_user"
                referencedTableName="user"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <!-- Add Foreign Key Constraint for User_Roles Table -->
    <changeSet id="addForeignKeyConstraintUserRolesTable" author="ilya.deus">
        <addForeignKeyConstraint
                baseTableName="user_roles"
                baseColumnNames="user_id"
                constraintName="fk_user_roles_user"
                referencedTableName="user"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
        <addForeignKeyConstraint
                baseTableName="user_roles"
                baseColumnNames="role_id"
                constraintName="fk_user_roles_role"
                referencedTableName="role"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <changeSet id="addDefaultRoles" author="ilya.deus">
        <sql>INSERT INTO role (name, description)
             VALUES ('USER', 'This is role for simple users')</sql>
        <sql>INSERT INTO role (name, description)
             VALUES ('MODERATOR', 'This is role for moderator')</sql>
        <sql>INSERT INTO role (name, description)
             VALUES ('ADMIN', 'This is role for users with admins rights')</sql>
    </changeSet>

    <!-- Create Account_Status Table -->
    <changeSet id="addAccountStatusTable" author="vladyslav.haivoronskyi">
        <createTable tableName="account_status">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="status_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="addDefaultStatus" author="vladyslav.haivoronskyi">
        <sql>INSERT INTO account_status (status_name, description)
             VALUES ('ACTIVE', 'This is status for active users')</sql>
        <sql>INSERT INTO account_status (status_name, description)
             VALUES ('INACTIVE', 'This is status for users with deleted account')</sql>
    </changeSet>

    <!-- Add Phone to the Goods Table -->
    <changeSet id="addPhoneGoodsTable " author="Oleksandr Tuleninov">
        <addColumn tableName="goods">
            <column name="phone" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- Add created_at, deleted_at fields to the User Table -->
    <changeSet id="addCreatedAndDeletedFieldsUserTable" author="Oleksandr Tuleninov">
        <addColumn tableName="user">
            <column name="created_at" type="TIMESTAMPTZ" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <addColumn tableName="user">
            <column name="deleted_at" type="TIMESTAMPTZ">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- Add columns created_at, last_modified, deleted_at for Goods Table -->
    <changeSet id="addColumnGoodsDates" author="Olena">
        <addColumn tableName="goods">
            <column name="created_at" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified" type="DATETIME">
                <constraints nullable="true"/>
            </column>
            <column name="deleted_at" type="DATETIME">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- Create Goods Status Table -->
    <changeSet id="createGoodsStatusTable" author="ilya.deus">
        <createTable tableName="goods_status">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="addDefaultGoodsStatus" author="vladyslav.haivoronskyi">
        <sql>INSERT INTO goods_status (name)
             VALUES ('ACTIVE')</sql>
        <sql>INSERT INTO goods_status (name)
             VALUES ('INACTIVE')</sql>
        <sql>INSERT INTO goods_status (name)
             VALUES ('DELETED')</sql>
    </changeSet>

    <!-- Create User_Roles Join Table -->
    <changeSet id="addMapTableGoodsAndGoodsStatus" author="ilya.deus">
        <createTable tableName="goods_goods_status">
            <column name="goods_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="goods_status_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="createRegionsTable" author="alex.ilchenko">
        <createTable tableName="regions">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="region" type="VARCHAR(60)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="insertRegionData" author="alex.ilchenko">
        <sql>INSERT INTO regions (region)
             VALUES ('Вінницька');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Волинська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Дніпропетровська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Донецька');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Житомирська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Закарпатська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Запорізька');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Івано-Франківська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Київ');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Київська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Кіровоградська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Луганська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Львівська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Миколаївська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Одеська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Полтавська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Республіка Крим');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Рівненська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Севастополь');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Сумська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Тернопільська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Харківська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Херсонська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Хмельницька');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Черкаська');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Чернівецька');</sql>
        <sql>INSERT INTO regions (region)
             VALUES ('Чернігівська');</sql>
    </changeSet>

    <changeSet id="addLocationTable" author="alex.ilchenko">
        <createTable tableName="location">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="settlement" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="region_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="addForeignKeyInLocation" author="alex.ilchenko">
        <addForeignKeyConstraint
                baseTableName="location"
                baseColumnNames="region_id"
                constraintName="fk_locations_region"
                referencedTableName="regions"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <changeSet id="changeLocationColumn" author="alex.ilchenko">
        <addColumn tableName="goods">
            <column name="location_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <addForeignKeyConstraint baseTableName="goods"
                                 baseColumnNames="location_id"
                                 constraintName="fk_goods_location"
                                 referencedTableName="location"
                                 referencedColumnNames="id"/>
        <dropColumn tableName="goods" columnName="location"/>
    </changeSet>

    <!-- Create Category Table -->
    <changeSet id="addCategoryTable" author="Oleksandr Tuleninov">
        <createTable tableName="category">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Insert data to Category Table -->
    <changeSet id="insertDataCategoryTable" author="Oleksandr Tuleninov">
        <sql>INSERT INTO category (name)
             VALUES ('REAL_ESTATE')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('TRANSPORT_AND_SPECIAL_EQUIPMENT')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('TECH_AND_ELECTRONICS')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('CLOTHING_AND_ACCESSORIES')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('RECREATION_EQUIPMENT')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('TOOLS_AND_EQUIPMENT')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('SPORTS_EQUIPMENT')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('BEAUTY_AND_HEALTH')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('EVENT_GOODS')</sql>
    </changeSet>

    <!-- Add Category to Goods Table -->
    <changeSet id="addCategoryGoodsTable" author="Oleksandr Tuleninov">
        <addColumn tableName="goods">
            <column name="category" type="VARCHAR(255)"/>
            <column name="category_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- Add Foreign Key Constraint for Goods Table -->
    <changeSet id="addForeignKeyConstraintGoodsTable" author="Oleksandr Tuleninov">
        <addForeignKeyConstraint
                baseTableName="goods"
                baseColumnNames="category_id"
                constraintName="fk_goods_category_fk"
                referencedTableName="category"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <!-- Creat the user_reviews table -->
    <changeSet id="addUserReviewsTable" author="Opanasenko-Mykhailo">
        <createTable tableName="user_reviews">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="reviewer_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="reviewed_user_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="rating" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="comment" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="timestamp">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                baseTableName="user_reviews"
                baseColumnNames="reviewer_id"
                referencedTableName="user"
                referencedColumnNames="id" constraintName="fk_reviewer_id"/>
        <addForeignKeyConstraint
                baseTableName="user_reviews"
                baseColumnNames="reviewed_user_id"
                referencedTableName="user"
                referencedColumnNames="id" constraintName="fk_reviewed_user_id"/>
    </changeSet>

    <changeSet id="createFeedbackTable" author="Opanasenko-Mykhailo">
        <createTable tableName="feedback">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="true"/>
            </column>
            <column name="title" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="message" type="varchar(1000)">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="timestamp">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

</databaseChangeLog>