<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd">

    <!-- Create Goods Table -->
    <changeSet id="addGoodsTable" author="ilya.deus">
        <createTable tableName="goods">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(1000)">
                <constraints nullable="false"/>
            </column>
            <column name="price" type="DECIMAL(19, 2)">
                <constraints nullable="false"/>
            </column>
            <column name="location" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Create Role Table -->
    <changeSet id="addRoleTable" author="ilya.deus">
        <createTable tableName="role">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Create User Table -->
    <changeSet id="addUserTable" author="ilya.deus">
        <createTable tableName="user">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="username" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="phone" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Create User_Roles Join Table -->
    <changeSet id="addUserRolesJoinTable" author="ilya.deus">
        <createTable tableName="user_roles">
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="role_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Add Foreign Key Constraint for Goods Table -->
    <changeSet id="addForeignKeyConstraintGoodsTable" author="ilya.deus">
        <addForeignKeyConstraint
                baseTableName="goods"
                baseColumnNames="user_id"
                constraintName="fk_goods_user"
                referencedTableName="user"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <!-- Add Foreign Key Constraint for User_Roles Table -->
    <changeSet id="addForeignKeyConstraintUserRolesTable" author="ilya.deus">
        <addForeignKeyConstraint
                baseTableName="user_roles"
                baseColumnNames="user_id"
                constraintName="fk_user_roles_user"
                referencedTableName="user"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
        <addForeignKeyConstraint
                baseTableName="user_roles"
                baseColumnNames="role_id"
                constraintName="fk_user_roles_role"
                referencedTableName="role"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <changeSet id="addDefaultRoles" author="ilya.deus">
        <sql>INSERT INTO role (name, description)
             VALUES ('USER', 'This is role for simple users')</sql>
        <sql>INSERT INTO role (name, description)
             VALUES ('MODERATOR', 'This is role for moderator')</sql>
        <sql>INSERT INTO role (name, description)
             VALUES ('ADMIN', 'This is role for users with admins rights')</sql>
    </changeSet>

    <!-- Create Account_Status Table -->
    <changeSet id="addAccountStatusTable" author="vladyslav.haivoronskyi">
        <createTable tableName="account_status">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="status_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="addDefaultStatus" author="vladyslav.haivoronskyi">
        <sql>INSERT INTO account_status (status_name, description)
             VALUES ('ACTIVE', 'This is status for active users')</sql>
        <sql>INSERT INTO account_status (status_name, description)
             VALUES ('INACTIVE', 'This is status for users with deleted account')</sql>
    </changeSet>

    <!-- Add Phone to the Goods Table -->
    <changeSet id="addPhoneGoodsTable " author="Oleksandr Tuleninov">
        <addColumn tableName="goods">
            <column name="phone" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- Add created_at, deleted_at fields to the User Table -->
    <changeSet id="addCreatedAndDeletedFieldsUserTable" author="Oleksandr Tuleninov">
        <addColumn tableName="user">
            <column name="created_at" type="TIMESTAMPTZ" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <addColumn tableName="user">
            <column name="deleted_at" type="TIMESTAMPTZ">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- Add columns created_at, last_modified, deleted_at for Goods Table -->
    <changeSet id="addColumnGoodsDates" author="Olena">
        <addColumn tableName="goods">
            <column name="created_at" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified" type="DATETIME">
                <constraints nullable="true"/>
            </column>
            <column name="deleted_at" type="DATETIME">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- Create Goods Status Table -->
    <changeSet id="createGoodsStatusTable" author="ilya.deus">
        <createTable tableName="goods_status">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="addDefaultGoodsStatus" author="vladyslav.haivoronskyi">
        <sql>INSERT INTO goods_status (name)
             VALUES ('ACTIVE')</sql>
        <sql>INSERT INTO goods_status (name)
             VALUES ('INACTIVE')</sql>
        <sql>INSERT INTO goods_status (name)
             VALUES ('DELETED')</sql>
    </changeSet>

    <!-- Create User_Roles Join Table -->
    <changeSet id="addMapTableGoodsAndGoodsStatus" author="ilya.deus">
        <createTable tableName="goods_goods_status">
            <column name="goods_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="goods_status_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="createRegionTable" author="alex.ilchenko">
        <createTable tableName="region">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="region" type="VARCHAR(60)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="insertRegionData" author="alex.ilchenko">
        <sql>INSERT INTO region (region)
             VALUES ('Вінницька');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Волинська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Дніпропетровська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Донецька');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Житомирська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Закарпатська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Запорізька');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Івано-Франківська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Київ');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Київська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Кіровоградська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Луганська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Львівська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Миколаївська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Одеська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Полтавська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Республіка Крим');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Рівненська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Севастополь');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Сумська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Тернопільська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Харківська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Херсонська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Хмельницька');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Черкаська');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Чернівецька');</sql>
        <sql>INSERT INTO region (region)
             VALUES ('Чернігівська');</sql>
    </changeSet>

    <changeSet id="addLocationTable" author="alex.ilchenko">
        <createTable tableName="location">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="settlement" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="region_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="addForeignKeyInLocation" author="alex.ilchenko">
        <addForeignKeyConstraint
                baseTableName="location"
                baseColumnNames="region_id"
                constraintName="fk_locations_region"
                referencedTableName="region"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <changeSet id="changeLocationColumn" author="alex.ilchenko">
        <addColumn tableName="goods">
            <column name="location_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <addForeignKeyConstraint baseTableName="goods"
                                 baseColumnNames="location_id"
                                 constraintName="fk_goods_location"
                                 referencedTableName="location"
                                 referencedColumnNames="id"/>
        <dropColumn tableName="goods" columnName="location"/>
    </changeSet>

    <!-- Create Category Table -->
    <changeSet id="addCategoryTable" author="Oleksandr Tuleninov">
        <createTable tableName="category">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Insert data to Category Table -->
    <changeSet id="insertDataCategoryTable" author="Oleksandr Tuleninov">
        <sql>INSERT INTO category (name)
             VALUES ('REAL_ESTATE')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('TRANSPORT_AND_SPECIAL_EQUIPMENT')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('TECH_AND_ELECTRONICS')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('CLOTHING_AND_ACCESSORIES')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('RECREATION_EQUIPMENT')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('TOOLS_AND_EQUIPMENT')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('SPORTS_EQUIPMENT')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('BEAUTY_AND_HEALTH')</sql>
        <sql>INSERT INTO category (name)
             VALUES ('EVENT_GOODS')</sql>
    </changeSet>

    <!-- Add Category to Goods Table -->
    <changeSet id="addCategoryGoodsTable" author="Oleksandr Tuleninov">
        <addColumn tableName="goods">
            <column name="category" type="VARCHAR(255)"/>
            <column name="category_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- Add Foreign Key Constraint for Goods Table -->
    <changeSet id="addForeignKeyConstraintGoodsTable" author="Oleksandr Tuleninov">
        <addForeignKeyConstraint
                baseTableName="goods"
                baseColumnNames="category_id"
                constraintName="fk_goods_category_fk"
                referencedTableName="category"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <!-- Creat the user_reviews table -->
    <changeSet id="addUserReviewsTable" author="Opanasenko-Mykhailo">
        <createTable tableName="user_reviews">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="reviewer_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="reviewed_user_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="rating" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="comment" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="timestamp">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                baseTableName="user_reviews"
                baseColumnNames="reviewer_id"
                referencedTableName="user"
                referencedColumnNames="id" constraintName="fk_reviewer_id"/>
        <addForeignKeyConstraint
                baseTableName="user_reviews"
                baseColumnNames="reviewed_user_id"
                referencedTableName="user"
                referencedColumnNames="id" constraintName="fk_reviewed_user_id"/>
    </changeSet>
    <changeSet id="addRatingColumnToUserTable" author="Opanasenko-Mykhailo">
        <addColumn tableName="user">
            <column name="rating" type="FLOAT"/>
        </addColumn>
    </changeSet>

    <!-- Create Message Table -->
    <changeSet id="createMessageTable" author="vitalii.shkaraputa">
        <createTable tableName="messages">
            <column name="id" type="UUID">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="text" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="goods_id" type="BIGINT">
                <constraints nullable="false"
                             foreignKeyName="goods_id"
                             referencedTableName="goods"
                             referencedColumnNames="id"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"
                             foreignKeyName="user_id"
                             referencedTableName="user"
                             referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Added weekends price to goods-->
    <changeSet id="addWeekendsPrice" author="Oleksandr Panchenko">
        <addColumn tableName="goods">
            <column name="weekends_price" type="DECIMAL(19, 2)">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <!-- Create complaint table-->
    <changeSet id="createComplaintTable" author="Oleksandr Panchenko">
        <createTable tableName="complaint">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="complaint_category_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="goods_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(1000)">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="DATETIME">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Create complaint category table-->
    <changeSet id="createComplaintCategoryTable" author="Oleksandr Panchenko">
        <createTable tableName="complaint_category">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(1000)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Add Foreign Keys Constraint for Complaint Table -->
    <changeSet id="addForeignKeysComplaintTable" author="Oleksandr Panchenko">
        <addForeignKeyConstraint
                baseTableName="complaint"
                baseColumnNames="complaint_category_id"
                constraintName="fk_complaint_category"
                referencedTableName="complaint_category"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
        <addForeignKeyConstraint
                baseTableName="complaint"
                baseColumnNames="user_id"
                constraintName="fk_complaint_user"
                referencedTableName="user"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
        <addForeignKeyConstraint
                baseTableName="complaint"
                baseColumnNames="goods_id"
                constraintName="fk_complaint_goods"
                referencedTableName="goods"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <!-- Add default complaint categories from Complaint_category table -->
    <changeSet id="addDefaultComplaintCategories" author="Oleksandr Panchenko">
        <sql>INSERT INTO complaint_category (name)
             VALUES ('Fraud')</sql>
        <sql>INSERT INTO complaint_category (name)
             VALUES ('Violation of copyright')</sql>
        <sql>INSERT INTO complaint_category (name)
             VALUES ('Unacceptable content')</sql>
    </changeSet>

    <changeSet id="createFeedbackTable" author="Opanasenko-Mykhailo">
        <createTable tableName="feedback">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="bigint">
                <constraints nullable="true"/>
            </column>
            <column name="title" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="message" type="varchar(1000)">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="timestamp">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Add is_potentially_scam column to user table -->
    <changeSet id="addIsPotentiallyScamToUser" author="kyrylo.fursov">
        <addColumn tableName="user">
            <column name="is_potentially_scam" type="boolean" defaultValue="false">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="addUserLastActivity" author="Opanasenko-Mykhailo">
        <addColumn tableName="user">
            <column name="last_activity" type="TIMESTAMP"/>
        </addColumn>
    </changeSet>

    <!-- Create Favorite_Goods Join Table -->
    <changeSet id="addFavoriteGoodsTable" author="vladyslav.haivoronskyi">
        <createTable tableName="user_favorite_goods">
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="goods_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Add Foreign Key Constraint for User_Favorite_Goods Table -->
    <changeSet id="addUserFavoriteGoodsTable" author="vladyslav.haivoronskyi">
        <addForeignKeyConstraint
                baseTableName="user_favorite_goods"
                baseColumnNames="user_id"
                constraintName="fk_user_favorite_goods_user"
                referencedTableName="user"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
        <addForeignKeyConstraint
                baseTableName="user_favorite_goods"
                baseColumnNames="goods_id"
                constraintName="fk_user_favorite_goods_goods"
                referencedTableName="goods"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <!-- Create Rental Card Table -->
    <changeSet id="addRentalCardTable" author="Olena.Sinkevych">
        <createTable tableName="rental_card">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="created_at" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column name="lessor_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="renter_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="first_date" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column name="last_date" type="timestamp">
                <constraints nullable="true"/>
            </column>
            <column name="duration" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="quantity" type="BIGINT">
                <constraints nullable="true"/>
            </column>
            <column name="goods_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="rental_price" type="DECIMAL(19, 2)">
                <constraints nullable="true"/>
            </column>
            <column name="fine" type="DECIMAL(19, 2)">
                <constraints nullable="true"/>
            </column>
            <column name="description" type="VARCHAR(1000)">
                <constraints nullable="true"/>
            </column>
            <column name="deleted_at" type="timestamp">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint
                baseTableName="rental_card"
                baseColumnNames="lessor_id"
                constraintName="fk_lessor_user"
                referencedTableName="user"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
        <addForeignKeyConstraint
                baseTableName="rental_card"
                baseColumnNames="renter_id"
                constraintName="fk_renter_user"
                referencedTableName="user"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
        <addForeignKeyConstraint
                baseTableName="rental_card"
                baseColumnNames="goods_id"
                constraintName="fk_card_goods"
                referencedTableName="goods"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <changeSet id="addGoodsView" author="vladyslav.haivoronskyi">
        <createTable tableName="goods_view">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="true"/>
            </column>
            <column name="ip" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column name="goods_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="addGoodsViewForeignKey" author="vladyslav.haivoronskyi">
        <addForeignKeyConstraint baseTableName="goods_view"
                                 baseColumnNames="goods_id"
                                 constraintName="fk_goods_view_goods_id"
                                 referencedTableName="goods"
                                 referencedColumnNames="id"
                                 onDelete="CASCADE"
                                 onUpdate="CASCADE"/>
    </changeSet>
    <changeSet id="add_is_new_column_to_goods_table" author="Opanasenko-Mykhailo">
        <addColumn tableName="goods">
            <column name="is_new" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="create_photo_table" author="kyrylo.fursov">
        <createTable tableName="photo">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pk_photo"/>
            </column>
            <column name="web_view_link" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="create-checkout-table" author="alex.ilchenko">
        <createTable tableName="checkout">
            <column name="id" type="uuid">
                <constraints primaryKey="true"/>
            </column>
            <column name="action" type="varchar(20)">
                <constraints nullable="false"/>
            </column>
            <column name="amount" type="decimal(19, 2)">
                <constraints nullable="false"/>
            </column>
            <column name="currency" type="varchar(3)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="version" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>


    <changeSet id="addTopGoodsPlacement" author="vladyslav.haivoronskyi">
        <createTable tableName="top_goods_placement">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="true"/>
            </column>
            <column name="goods_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="start_at" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column name="end_at" type="timestamp">
                <constraints nullable="false"/>
            </column>

        </createTable>
    </changeSet>

    <changeSet id="addTopGoodsPlacementForeignKey" author="vladyslav.haivoronskyi">
        <addForeignKeyConstraint baseTableName="top_goods_placement"
                                 baseColumnNames="goods_id"
                                 constraintName="fk_top_goods_placement_goods_id"
                                 referencedTableName="goods"
                                 referencedColumnNames="id"
                                 onDelete="CASCADE"
                                 onUpdate="CASCADE"/>
    </changeSet>

    <changeSet id="modify_goods_table" author="Opanasenko-Mykhailo">
        <dropColumn tableName="goods" columnName="is_new"/>
        <addColumn tableName="goods">
            <column name="goods_condition" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="addDefaultGoodsCondition" author="Opanasenko-Mykhailo">
        <sql>
            UPDATE goods
            SET goods_condition = 'NEW'
            WHERE goods_condition IS NULL
               OR goods_condition = '';
        </sql>
    </changeSet>

    <changeSet id="addSendAtForMessages" author="vladyslav.haivoronskyi">
        <addColumn tableName="messages">
            <column name="send_at" type="timestamp">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="deletePhoneColumn" author="alex.ilchenko">
        <dropColumn tableName="goods" columnName="phone"/>
    </changeSet>

    <changeSet id="update_roles" author="Olena.Sinkevych">
        <addColumn tableName="user_roles">
            <column name="role" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <update tableName="user_roles">
            <column name="role" value="USER"/>
            <where>role_id='1'</where>
        </update>
        <update tableName="user_roles">
            <column name="role" value="MODERATOR"/>
            <where>role_id='2'</where>
        </update>
        <update tableName="user_roles">
            <column name="role" value="ADMIN"/>
            <where>role_id=3</where>
        </update>
    </changeSet>

    <changeSet id="modifyUserRolesJoinTable" author="Olena.Sinkevych">
        <dropAllForeignKeyConstraints  baseTableName="user_roles"/>
        <dropTable  cascadeConstraints="true"
                    tableName="role"/>
        <dropColumn tableName="user_roles" columnName="role_id"/>
        <addUniqueConstraint  columnNames="user_id, role"
                              constraintName="user_role"
                              deferrable="true"
                              disabled="true"
                              initiallyDeferred="true"
                              tableName="user_roles"
                              tablespace="A String"
                              validate="true"/>
        <addForeignKeyConstraint
                baseTableName="user_roles"
                baseColumnNames="user_id"
                constraintName="fk_role_user"
                referencedTableName="user"
                referencedColumnNames="id"
                onDelete="CASCADE"
                onUpdate="CASCADE"/>
    </changeSet>

    <changeSet id="createUserStatusField" author="vitalii.kalinchyk">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="user" columnName="status"/>
            </not>
        </preConditions>
        <addColumn tableName="user">
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="moveValuesToUserStatus" author="vitalii.kalinchyk">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="user" columnName="account_status_id"/>
        </preConditions>
        <sql>
            UPDATE user
            SET status = CASE
                             WHEN account_status_id = 1 THEN 'ACTIVE'
                             ELSE 'SUSPENDED'
                END;
        </sql>
    </changeSet>

    <changeSet id="dropAccountStatusForeignKey" author="vitalii.kalinchyk">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="user" foreignKeyName="FKsdwiqho2tvg6if7lrb65w4tud"/>
        </preConditions>
        <sql>ALTER TABLE user DROP FOREIGN KEY FKsdwiqho2tvg6if7lrb65w4tud</sql>
    </changeSet>

    <changeSet id="dropAccountStatusField" author="vitalii.kalinchyk">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="user" columnName="account_status_id"/>
        </preConditions>
        <dropColumn tableName="user" columnName="account_status_id"/>
    </changeSet>

    <changeSet id="dropAccountStatusTable" author="vitalii.kalinchyk">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="account_status"/>
        </preConditions>
        <dropTable tableName="account_status"/>
    </changeSet>

    <changeSet id="AddStatusFieldToGoodsTable" author="vitalii.kalinchyk">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="goods" columnName="status"/>
            </not>
        </preConditions>
        <addColumn tableName="goods">
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="moveGoodsStatusToFieldGoodsStatusInGoods" author="vitalii.kalinchyk">
        <preConditions onFail="MARK_RAN">
            <and>
                <tableExists tableName="goods_goods_status" />
                <tableExists tableName="goods_status" />
            </and>
        </preConditions>
        <sql>UPDATE goods g JOIN goods_goods_status ggs ON g.id = ggs.goods_id
            JOIN goods_status gs ON ggs.goods_status_id = gs.id
            SET g.status = gs.name</sql>
    </changeSet>

    <changeSet id="dropGoodsGoodsStatusTable" author="vitalii.kalinchyk">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="goods_goods_status"/>
        </preConditions>
        <dropTable tableName="goods_goods_status"/>
    </changeSet>

    <changeSet id="dropGoodsStatusTable" author="vitalii.kalinchyk">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="goods_status"/>
        </preConditions>
        <dropTable tableName="goods_status"/>
    </changeSet>

    <changeSet id="deleteColumnPrice" author="vladyslav.haivoronskyi">
        <dropColumn tableName="goods" columnName="price"/>
    </changeSet>
    <changeSet id="deleteColumnAmountAndCurrency" author="vladyslav.haivoronskyi">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="goods" columnName="amount"/>
            <columnExists tableName="goods" columnName="currency"/>
        </preConditions>
        <dropColumn tableName="goods" columnName="amount"/>
        <dropColumn tableName="goods" columnName="currency"/>
    </changeSet>

</databaseChangeLog>